(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}})();(function(z){function B(w){if(w===true){return 1}return parseInt(w)||0}function y(){if(window._sbWidth===undefined){var w=z("<div>").css({overflowY:"scroll",position:"absolute",width:"50px",height:"50px"}).html('<div style="height: 75px;">1<br>1</div>').get(0);z("body")[0].appendChild(w);window._sbWidth=w.offsetWidth-w.firstChild.offsetWidth-1;z("body")[0].removeChild(w)}return window._sbWidth}function g(w){l=y();try{var C=Math.max(B(o.innerWidth),B(n.clientWidth),B(w));var D=Math.max(B(o.innerHeight),B(n.clientHeight));if(v.mobile){C=B(o.innerWidth);D=B(o.innerHeight)}else{(v.msie7&&n.scrollHeight>n.offsetHeight&&(C+=l+2))||(v.msie8&&n.scrollHeight+3>n.offsetHeight&&(C+=l+1))}if(C<1000){C=1000+l}C=C-l-1;if(o.lastWindowWidth!=C){o.lastWindowWidth=C}if(o.lastWindowHeight!=D){o.lastWindowHeight=D}return C}catch(E){s();return arguments.callee()}}function m(w){n.scrollTop=w;if(!(w>n.scrollTop-10&&w<n.scrollTop+10)){setTimeout(function(){m(w)},10)}}function d(C){if(!e.visible){return}var w=C.target,D=e.stack.length-1;if(D>-1){if(w===c){e.stack[D].popup.close();return false}}}function A(F){if(!e.visible){return}var C=F.target,G=e.stack.length-1;if(G>-1){for(var w=G;w>=0;w-=1){var E=e.stack[w].popup.getElement()[0];for(var D=C;D!=j;D=D.parentNode){if(D==E){e.stack[w].popup.close();return false}}}}else{e.hide()}}function p(D){D.preventDefault();for(var w=e.stack.length-1;w>=0;w-=1){for(var C=this;C!=n;C=C.parentNode){if(C==e.stack[w].parentNode){e.stack[w].popup.close();w=0;break}}}}var l,x,f,r,i,u=false,k=navigator.userAgent.toLowerCase(),v={version:(k.match(/.+(?:me|ox|on|rv|it|era|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],opera:/opera/i.test(k),msie:(/msie/i.test(k)&&!/opera/i.test(k)),msie6:(/msie 6/i.test(k)&&!/opera/i.test(k)),msie7:(/msie 7/i.test(k)&&!/opera/i.test(k)),msie8:(/msie 8/i.test(k)&&!/opera/i.test(k)),msie9:(/msie 9/i.test(k)&&!/opera/i.test(k)),mozilla:/firefox/i.test(k),chrome:/chrome/i.test(k),safari:(!(/chrome/i.test(k))&&/webkit|safari|khtml/i.test(k)),iphone:/iphone/i.test(k),ipod:/ipod/i.test(k),iphone4:/iphone.*OS 4/i.test(k),ipod4:/ipod.*OS 4/i.test(k),ipad:/ipad/i.test(k),android:/android/i.test(k),bada:/bada/i.test(k),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(k),msie_mobile:/iemobile/i.test(k),safari_mobile:/iphone|ipod|ipad/i.test(k),opera_mobile:/opera mini|opera mobi/i.test(k),opera_mini:/opera mini/i.test(k),mac:/mac/i.test(k),windows_phone:/windows phone/i.test(k)},o,n,h,j,q,c,t={},a,s=function(){if(j===undefined){try{a=(navigator.userAgent.indexOf("WebKit")>0);j=document.getElementById("overlay");q=document.getElementById("overlay_bg");c=document.getElementById("overlay_wrapper");h=document.getElementById("wrap");n=(a)?document.body:document.documentElement;o=window;l=y();z(o).bind("WM_RESIZE",e.resize).resize(function(C){if(!u){z(o).trigger("WM_RESIZE")}});z(j).on("keydown click tap",".close,.close-popup",A);z(c).bind("keydown click tap",d)}catch(w){return false}}return e},e={browser:v,stack:[],visible:false,show:function(){if(e.visible){return}u=true;e.visible=true;if(!z(q).stop(true,false).is(":visible")){t.p_width=h.style.width;t.p_height=h.style.height;t.b_scrollTop=n.scrollTop;t.p_position=h.style.position;h.style.position=(v.msie7||v.mobile?"absolute":"fixed");h.style.overflow="hidden";h.scrollTop=t.b_scrollTop;n.scrollTop=0;j.style.display="block"}(v.msie7||v.msie8||v.mobile)?q.style.display="block":z(q).fadeIn(500,function(){});u=false;e.resize();return this},hide:function(){u=true;loadTriger=true;e.visible=false;(function(w){if(v.msie7||v.msie8||v.mobile){q.style.display="none";w()}else{z(q).fadeOut(400,w)}})(function(){j.style.display="none";h.style.position=t.p_position;h.style.overflow="visible";h.scrollTop=0;if(t.b_scrollTop){m(t.b_scrollTop)}h.style.width=t.p_width;u=false});return this},update:function(){u=true;x=r=Math.max(B(o.innerWidth),B(n.clientWidth));f=i=Math.max(B(o.innerHeight),B(n.clientHeight));if(v.mobile){x=r=B(o.innerWidth);f=i=B(o.innerHeight)}for(var w=0,C=e.stack.length;w<C;w+=1){e.stack[w].popup.setpos(x,f)}if(v.msie7&&i>f){r+=l+2}else{if(v.msie8&&i>f){r+=l+1}}if(!v.mobile&&i>f){r-=l+2}u=false;z(window).trigger("wm_update")},resize:function(w){u=true;if(e.visible){e.update()}z(".fix").width(g());u=false},getScrollTop:function(){return e.visible?t.b_scrollTop+n.scrollTop:n.scrollTop}},b=function(H,C){var I=z("<div>",{"class":"popup"}),w=H,F=z.extend({close_button:z(H).data("modal-close-button"),onOpen:function(){},onClose:function(){},top:0,left:0},C),E,D,G={visible:false,onOpen:F.onOpen,onClose:F.onClose,init:function(){w.popup=G;try{E=w.parentNode;D=document.createElement("div");E.insertBefore(D,w)}catch(J){}if(typeof(F.close_button)==="undefined"){F.close_button=true}if(F.close_button){this.addCloseButton()}if(z(H).data("modal-class")){I.addClass($(H).data("modal-class"))}I[0].insertBefore(w,null);w.style.display="block";I.css({zIndex:1000,position:"absolute","margin-left":"-20000px"});c.appendChild(I[0]);e.stack.push(w)},addCloseButton:function(){I.append(z("<i>",{"class":"icon close",title:"Закрыть"}))},show:function(J){if(this.visible){if(J){J()}return}this.visible=true;e.visible?e.update():e.show();I.css({display:"none","margin-left":"0px"}).animate({opacity:"show"},{duration:200,complete:function(){if(J){J()}}})},hide:function(J){u=true;I.fadeOut(200,function(){I.css({display:"none"});G.visible=false;e.update();if(J){J()}u=false})},open:function(){if(w.popup==undefined){this.init()}else{e.stack.push(w)}if(e.stack.length<=1&&!this.visible){}else{if(e.stack.length>1){e.stack[e.stack.length-2].popup.hide()}}G.show(G.onOpen);return G},close:function(){if(e.stack.length>1){e.stack[e.stack.length-2].popup.show()}else{e.hide()}e.stack.splice(e.stack.indexOf(w),1);G.hide(function(){G.onClose();if(e.stack.length==0){e.hide()}})},setpos:function(J,K){if(!G.visible){return}if(J<I.width()+(F.left+80)){J=I.width()+(F.left+80);if(r<J){r=J}}if(K<I.height()+(F.top+80)){K=I.height()+(F.top+80);if(i<K){i=K}}I.css({left:F.left||Math.round((J-I.width())/2-(y()/2))+"px",top:F.top||Math.round((K-I.height())/2)+"px"})},getElement:function(){return I},update:function(J){if(typeof(J.jquery)==="string"){I.empty().append(J);if(F.close_button){this.addCloseButton()}J.get(0).popup=w.popup}return this},remove:function(){e.stack.splice(e.stack.indexOf(w),1);I.remove().empty();w.popup==null;G=null}};s();return G};z.fn.popup=function(w){if(typeof(this.get(0).popup)!=="undefined"){return this.get(0).popup}else{return b(this.get(0),w)}};window.wm=e})(jQuery);