(function(a){a.extend(Tapestry,{Validator:{}});a.extend(Tapestry.Initializer,{validate:function(b){a.each(b,function(d,c){var d=a("#"+d);d.tapestryFieldEventManager();a.each(c,function(g,i){var f=i[0];var h=i[1];var l=i[2];var m=Tapestry.Validator[f];if(m==undefined){a().log(Tapestry.Messages.missingValidator+"\n--> validator name : "+f+"\n & field name :"+d.attr("id"));return}try{m.call(this,d,h,l)}catch(k){a().log(Tapestry.Messages.invocationException+"\n--> fname : Tapestry.Validator."+f+"\n & params :"+d.id+", "+h+", "+l+"\n& exeption :"+k)}})})}});a.widget("ui.tapestryFieldEventManager",{options:{show:"highlight",validationError:false,requiredCheck:null,translator:function(b){return(b)}},_create:function(){var c=this;var d=this.element;this.options.id=d.attr("id");var b=d.closest("form");if(b.formEventManager("option","validateOnBlur")){a(document).bind(Tapestry.FOCUS_CHANGE_EVENT,function(e){if(Tapestry.currentFocusField==d[0]){c.validateInput()}})}if(b.formEventManager("option","validateOnSubmit")){b.bind(Tapestry.FORM_VALIDATE_FIELDS_EVENT,function(e){c.validateInput()})}},getLabel:function(){if(!this.options.label){var b="label[for='"+this.options.id+"']";this.options.label=a(b)}return this.options.label},getIcon:function(){if(!this.options.icon){this.options.icon=a("#"+this.options.id+"_icon")}return this.options.icon},removeDecorations:function(){var b=this.element;b.removeClass("t-error");this.getLabel()&&this.getLabel().removeClass("t-error");this.getIcon()&&this.getIcon().hide();Tapestry.ErrorPopup.hide(a("#"+b.attr("id")+"\\:errorpopup"))},showValidationMessage:function(d){var e=this.element;var c=e.closest("form");this.options.validationError=true;c.formEventManager("setValidationError",true);e.addClass("t-error");this.getLabel()&&this.getLabel().addClass("t-error");var b=this.getIcon();if(b){b.show()}var f=e.attr("id")+"\\:errorpopup";if(a("#"+f).size()==0){e.after("<div id='"+e.attr("id")+":errorpopup' class='tjq-error-popup'/>")}Tapestry.ErrorPopup.show(a("#"+f),"<span>"+d+"</span>")},validateInput:function(){var d=this.element;if(d.filter(":disabled").size()!=0){return false}if(d.filter(":visible").size()==0){return false}this.options.validationError=false;var b=d.val();if(this.options.requiredCheck){this.options.requiredCheck.call(this,b)}if(!this.options.validationError&&!((typeof b=="string")&&b=="")){var c=this.options.translator(b);if(!this.options.validationError){d.trigger(Tapestry.FIELD_VALIDATE_EVENT,[b,c])}}if(!this.options.validationError){this.removeDecorations()}return this.options.validationError}});a.extend(Tapestry,{Validator:{required:function(c,b){a(c).tapestryFieldEventManager({requiredCheck:function(d){if((typeof d=="string"&&d=="")||d==null){a(c).tapestryFieldEventManager("showValidationMessage",b)}}})},numericformat:function(d,b,c){a(d).tapestryFieldEventManager({translator:function(f){try{return a.tapestry.utils.formatLocalizedNumber(f,c)}catch(g){a(d).tapestryFieldEventManager("showValidationMessage",b)}}})},minlength:function(d,c,b){a.tapestry.utils.addValidator(d,function(e){if(e.length<b){throw c}})},maxlength:function(d,c,b){a.tapestry.utils.addValidator(d,function(e){if(e.length>b){throw c}})},min:function(d,b,c){a.tapestry.utils.addValidator(d,function(e){if(e<c){throw b}})},max:function(d,b,c){a.tapestry.utils.addValidator(d,function(e){if(e>c){throw b}})},regexp:function(e,b,d){var c=new RegExp(d);a.tapestry.utils.addValidator(e,function(f){if(!c.test(f)){throw b}})}}});a.extend(a.tapestry.utils,{addValidator:function(c,b){a(c).bind(Tapestry.FIELD_VALIDATE_EVENT,function(h,f,g){try{b.call(this,g)}catch(d){a(c).tapestryFieldEventManager("showValidationMessage",d)}});return c}});a.extend(Tapestry,{ErrorPopup:{show:function(b,c){b.html(c).show()},hide:function(b){b.hide()}}})})(jQuery);